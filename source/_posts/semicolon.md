title: javascript自动插入分号
date: 2015-01-03 19:01:55
tags:
    - javascript
---

有时会遇到没有分号的javascript代码，是不是javascript代码中的分号可以直接省略？并不是。无论我们写不写分号，都可能会遇到坑，下面讨论

可以不写分号，是因为javascript语言在解析时具有自动插入分号的功能，规则如下

# 规则

1 分号仅在``}``之前或换行符之前被插入

2 分号仅在代码不能正常解析时被插入
如下代码：
```
var b = function(){return 1}
var f = function(){return 2}

//情况1
a = b
f()     //2

//情况2
a = b
(f())   //1
```
对于上例两种情况，可能我们期望的结果是一样的，都如情况1. 但实际的结果却不一样。

当一行代码以``(, [, +, -, /``开始时，我们必须考虑它是否能和前面的代码一起解析，这样就会出现情况2. 对此，我们可以一遇到代码以``(, [, +, -, /``开头时，就在前面再加上一个``;``
```
//情况2
a = b
;(f())  
```

看到这里，我们会想，每行结尾都加上分号不就行了
```
a = b;
(f());
```

再看下例：
```
//情况1
return {a:1, b:2};

//情况2
return {
    a:1, 
    b:2
};

//情况3
return 
{
    a:1, 
    b:2
};
```
本例中，情况1和情况2都没有问题，但是情况3将被解析成
```
return;
{
    a:1, 
    b:2
}
;
```
可能是误按了一个回车或别的原因，但不会有任何报错，要特别注意！

还有一种情况
```
function a(){
    return 1;
}
[1, 2, 3].forEach(function(key){console.log(key)})  //不会报错

var a = function (){
                return 1;
            }
[1, 2, 3].forEach(function(key){console.log(key)})  //会报错
```
对于函数声明的两种方式，我们习惯于第一种结尾不加分号，第二种结尾加分号。但是如果第二种忘记加分号，则会报错，因为解析器认为这里是合理的代码，不需要自动加分号。

# 总结
1 写不加分号的代码有助于理解javascript解析时自动加分号的规则
2 除非只有一个人，否则应按团队的代码规范。
3 即使都加分号，也要理解这套规则，难免遇到